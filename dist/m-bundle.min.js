!function(){"use strict";const n=n=>null!=n&&"object"==typeof n,e=e=>n(e)?Object.keys(e):[],t=(e,...o)=>!n(e)||o.length<1?{has:n(e)&&o.length<1,o:e,key:o[0]}:1===o.length?{has:Object.hasOwnProperty.call(e,o[0]),o:e,key:o[0]}:t(e[o.shift()],...o),o=(n,e,...o)=>{const i=t(e,...o);return i.o&&i.o[i.key]||n},i=n=>null==n||""===n,r=(n,...e)=>e.filter(s(i)).join(n),l=(n,e)=>"function"==typeof n&&(null==e||n.length===e),s=n=>l(n)?(...e)=>!n(...e):!n,c=(()=>{let n,e;const t=t=>new Proxy(null!=t&&(e.has(t)?e.get(t):(n={},e.set(t,n),n)),{get:(n,e)=>n?n[e]:void 0,set:(n,e,t)=>n?n[e]=t:void 0});t.flush=(()=>{e=new WeakMap});t.flush();return t})(),u=(n,...e)=>{if(l(n))return n(...e)},f=(n,e)=>null!=n&&""!==n?n:e,d=function(n,e,t,o){if(!(null==n||arguments.length<3)){const[i,r]=t.split(":").reverse();if(3===arguments.length)return null==r?f(n.getAttribute(i),void 0):f(n.getAttributeNS(e[i],i),void 0);void 0===o?null==r?n.removeAttribute(i):n.removeAttributeNS(e[i],i):null==r?n.setAttribute(i,null==o?"":o):n.setAttributeNS(e[i],i,null==o?"":o)}};Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{enumerable:!1,value:function(){return this.reduce((n,e)=>n.concat(e),[])}});const a=function*(e){if(n(e))for(let n in e)"$"===n&&"object"!=typeof e.$?yield e.$:"$"!==n[0]&&"_"!==n[0]&&(yield n)};let h=class n{constructor(n,t,...i){let r;l(o(null,n,"view"))?(this.$=n,r=this):(this[n]={},r=this[n]),Object.assign(r,e(t).reduce((n,e)=>{n[e.replace(/^\$?/,"$")]=t[e];return n},{})),r._=i}};null==window.VNode?window.VNode=h:h=window.VNode,h.tag=(n=>{const e=a(n),t=e.next(),o=e.next();if(o.done)return t.value});h.attrs=function*(e,t){const o={};if(""===(e=e.replace(/\s*(?:#([^\s#\.[\]]+)|\.([^\s#\.[\]]+)|\[\s*([\w:]+[^\s=[\]]*)?(?:\s*=\s*(['"])?(.*?)\4)?\s*\])\s*/gi,(...n)=>{const[,e,t,i,,l,,]=n;null!=e?o.id=e:"string"==typeof t&&""!==t.trim()?o.class=r(" ",o.class,t):null!=i&&(o[i]=void 0===l?null:l);return""}))&&(e="div"),yield e,n(t))for(let n in t)"$class"===n?"string"==typeof t.$class&&""!==t.$class.trim()&&(o.class=r(" ",o.class,t.$class)):"$"===n[0]&&n.length>1&&(o[n.substr(1)]=t[n]);for(let n in o)yield{k:n,ev:"on"===n.substr(0,2)?n.substr(2):void 0,v:o[n]}},h.children=function*(e){if(null!=e)if(Array.isArray(e))for(const n of e)if(p.Component.isComponent(n))yield n;else for(const e of h.children(n))yield e;else if(n(e)){for(const n of a(e))yield Object.freeze({[n]:e[n]});for(const n of h.children(e._))yield n}else"string"!=typeof e&&"number"!=typeof e||(yield e)};let p=(e,...t)=>{const o={},i=[];for(let e,r=0;t.length>0;r++)e=t.shift(),0!==r||!n(e)||Array.isArray(e)||e instanceof h?Array.isArray(e)?i.splice(-1,0,...e):i.push(e):Object.assign(o,e);return new h(e,o,...i)};null==window.m?window.m=p:p=window.m,p.Component=class{constructor(n,e,...t){this.dom=null,this.static=n,this.attrs=e||{},this.children=t||[]}},p.Component.isComponent=(n=>l(o(null,n,"$","view"))),p.instance=((n,e)=>({state:n,oninit(t){if(!0!==n.inited)return n.inited=!0,t.state=n,u(e.oninit,t)},oncreate(t){if(!0!==n.created)return n.created=!0,t.state=n,u(e.oncreate,t)},onbeforeupdate(t){return t.state=n,u(e.onbeforeupdate,t)},onupdate(t){return t.state=n,u(e.onupdate,t)},view(t){return t.state=n,u(e.view,t)},onbeforeremove(t){return t.state=n,u(e.onbeforeremove,t)},onremove(t){t.state=n;const o=u(e.onremove,t);for(const e in n)delete n[e];return o}}));for(name of["oninit","view","oncreate","onbeforeupdate","onupdate","onbeforeremove","onremove"]){const n=name;p.Component[n]=((e,t)=>{if(!l(e.static[n]))return;null!=t&&(e.dom=t);return e.static[n](e)})}p.root=null;const m=["","key","dirty"],y=(n,e,t=null)=>null==e?document.createTextNode(t):null!=n[""]?document.createElementNS(n[""],e):document.createElement(e),v=(n,e,t)=>{if(t===c(n)[e])return;n.removeEventListener(e,c(n)[e],!0);n.addEventListener(e,c(n)[e]=t,!0)},b={insertBefore:0,appendChild:1,recycleChild:2,removeChild:3};let C;p.render=((e,t,i)=>{let r,l,s,u,f,a,g,w,k,N,$=[],A=new Set([]),j=-1;C=!1;const x=(n,e)=>{if(null==$||$.length<1)return;let t=[];for(const o of $)t.push(n(o,e));return t};const S=n=>{for(;p.Component.isComponent(n);){const e={},t=[],o=h.attrs("",n);o.next().value;for(const n of o)e[n.k]=n.v;for(const e of h.children(n))t.push(e);const i=new p.Component(n.$,e,...t);$.unshift(i),x(p.Component.oninit).some(n=>!1===n)?(C=!0,n=null):n=p.Component.view(i)}return n};const O=(n,e)=>{const t=$;$=n;x(p.Component.onbeforeremove);$=t;e();$=n;x(p.Component.onremove);$=t};const B=(n,e)=>{n(b.insertBefore,e);n(b.removeChild,e)};const T=(n,t)=>{switch(n){case b.insertBefore:case b.appendChild:r=b.insertBefore===n?e.insertBefore(y(i,f,l),t):e.appendChild(y(i,f,l));break;case b.recycleChild:if(null!=f){(r instanceof Text||(r.tagName||"").toUpperCase()!==f.toUpperCase())&&B(T,r);const n=new Set([]);for(g of r.getAttributeNames())n.add(g);for(g of a)m.includes(g.k)||(n.delete(g.k.split(":").pop()),null!=g.ev?v(r,g.ev,g.v):d(r,i,g.k)!==g.v&&d(r,i,g.k,g.v));for(g of n)d(r,i,g,void 0)}else r instanceof Text?r.data!==s&&(r.data=s):B(T,r);break;case b.removeChild:e.removeChild(t)}};t=S(t);let E=$.length;if(C)return;for(l of h.children(t)){for($.splice(E),j++;A.has(j);)j++;if(l=S(l),C)return;if(n(l)?(f=h.tag(l),s=l[f]):(f=null,s=l),null!=f){a=h.attrs(f,s),i=Object.assign({},i);for(const n in s)"$xmlns"===n?i[""]=s[n]:/^\$xmlns:/.test(n)&&(i[n.substr(7)]=s[n]);f=a.next().value}else a=void 0;if(u=null!=f?o(null,s,"$key"):null,k=j,N=!1,null!=u){if(c(e.childNodes[j]).key===u)N=!0;else for(w=e.childNodes.length;!N&&w-- >0;)c(e.childNodes[w]).key===u&&(k=w,N=!0,j--);N||(T(b.insertBefore,e.childNodes[j]),c(e.childNodes[k]).key=u)}else null==e.childNodes[k]&&T(b.appendChild);if(A.add(k),(!N||!1!==o(null,s,"$dirty"))&&(r=e.childNodes[k],!1!==x(p.Component.onbeforeupdate)&&null==c(r).removing)){let e=[];const t=c(r).componentInstStack;if(null!=t)for(let n=t.length-1;n>=0;n--)if(null==$[n]||t[n].state!==$[n].state){e.push(t[n]);break}if(e.length>0?O(e,()=>{T(b.recycleChild)}):T(b.recycleChild),c(r).componentInstStack=$,n(l)&&(p.render(r,s,i),C))return;x(p.Component.oncreate,r),x(p.Component.onupdate,r)}}w=e.childNodes.length;for(;w-- >0;)r=e.childNodes[w],$=c(r).componentInstStack,A.has(w)||null!=c(r).removing||O($,()=>{T(b.removeChild,r)})});let g,w,k;p.lastRenderTime=0;const N=n=>{p.renderCount++;w=performance.now();try{p.render(document.body,p.root)}catch(n){throw n}finally{k=performance.now(),p.lastRenderTime=k-w,g=null}};p.renderCount=0,p.redraw=(()=>{if(null!=g)return;g=1;N()}),p.untrusted=(n=>"string"==typeof n?n:"number"==typeof n?""+n:(console.error("Malicious value",n),""))}();
//# sourceMappingURL=m-bundle.min.js.map
